# å›½é™…åŒ–å®ç°

<cite>
**Referenced Files in This Document**   
- [app/i18n/index.ts](file://app/i18n/index.ts)
- [app/i18n/client.ts](file://app/i18n/client.ts)
- [middleware.ts](file://middleware.ts)
- [config.ts](file://config.ts)
- [app/i18n/locales/zh/basic.json](file://app/i18n/locales/zh/basic.json)
- [app/i18n/locales/en/basic.json](file://app/i18n/locales/en/basic.json)
- [app/[lng]/layout.tsx](file://app/[lng]/layout.tsx)
</cite>

## ç›®å½•
1. [å›½é™…åŒ–å®ç°](#å›½é™…åŒ–å®ç°)
2. [i18næ¨¡å—æ¶æ„](#i18næ¨¡å—æ¶æ„)
3. [å¤šè¯­è¨€èµ„æºé…ç½®](#å¤šè¯­è¨€èµ„æºé…ç½®)
4. [æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯i18nåˆå§‹åŒ–](#æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯i18nåˆå§‹åŒ–)
5. [è¯­è¨€åŒ¹é…ä¸è·¯ç”±é‡å®šå‘æœºåˆ¶](#è¯­è¨€åŒ¹é…ä¸è·¯ç”±é‡å®šå‘æœºåˆ¶)
6. [è¯­è¨€é…ç½®å‚æ•°](#è¯­è¨€é…ç½®å‚æ•°)
7. [è¯­è¨€åˆ‡æ¢æµç¨‹](#è¯­è¨€åˆ‡æ¢æµç¨‹)
8. [ç»„ä»¶ä¸­çš„æ–‡æœ¬ç¿»è¯‘ä½¿ç”¨](#ç»„ä»¶ä¸­çš„æ–‡æœ¬ç¿»è¯‘ä½¿ç”¨)
9. [é™æ€è·¯å¾„é¢„ç”Ÿæˆ](#é™æ€è·¯å¾„é¢„ç”Ÿæˆ)

## i18næ¨¡å—æ¶æ„

blessedé¡¹ç›®çš„å›½é™…åŒ–å®ç°åŸºäºi18nextç”Ÿæ€ç³»ç»Ÿæ„å»ºï¼Œé‡‡ç”¨æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ååŒå·¥ä½œçš„æ¶æ„æ¨¡å¼ã€‚ç³»ç»Ÿé€šè¿‡`i18next`æ ¸å¿ƒåº“æä¾›ç¿»è¯‘åŠŸèƒ½ï¼Œç»“åˆ`react-i18next`å®ç°Reactç»„ä»¶é›†æˆï¼Œå¹¶åˆ©ç”¨`i18next-resources-to-backend`åŠ¨æ€åŠ è½½è¯­è¨€èµ„æºæ–‡ä»¶ã€‚

è¯¥æ¶æ„åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼šæœåŠ¡ç«¯åˆå§‹åŒ–é€»è¾‘ä½äº`app/i18n/index.ts`ï¼Œè´Ÿè´£åœ¨æœåŠ¡å™¨æ¸²æŸ“æ—¶æä¾›ç¿»è¯‘æœåŠ¡ï¼›å®¢æˆ·ç«¯hooké€»è¾‘ä½äº`app/i18n/client.ts`ï¼Œè´Ÿè´£åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ç®¡ç†è¯­è¨€çŠ¶æ€å’Œå“åº”è¯­è¨€åˆ‡æ¢ã€‚è¿™ç§åˆ†ç¦»è®¾è®¡ç¡®ä¿äº†æœåŠ¡ç«¯æ¸²æŸ“çš„SEOå‹å¥½æ€§å’Œå®¢æˆ·ç«¯äº¤äº’çš„å“åº”æ€§ã€‚

**Section sources**
- [app/i18n/index.ts](file://app/i18n/index.ts#L1-L54)
- [app/i18n/client.ts](file://app/i18n/client.ts#L1-L75)

## å¤šè¯­è¨€èµ„æºé…ç½®

é¡¹ç›®åœ¨`app/i18n/locales/`ç›®å½•ä¸‹ç»„ç»‡å¤šè¯­è¨€èµ„æºæ–‡ä»¶ï¼Œé‡‡ç”¨åŸºäºè¯­è¨€ä»£ç çš„ç›®å½•ç»“æ„ã€‚æ¯ä¸ªè¯­è¨€ç›®å½•åŒ…å«`basic.json`æ–‡ä»¶ï¼Œå­˜å‚¨è¯¥è¯­è¨€çš„ç¿»è¯‘é”®å€¼å¯¹ã€‚å½“å‰æ”¯æŒä¸­æ–‡(`zh`)å’Œè‹±æ–‡(`en`)ä¸¤ç§è¯­è¨€ã€‚

ç¿»è¯‘èµ„æºé‡‡ç”¨æ‰å¹³åŒ–çš„é”®å€¼ç»“æ„ï¼Œå¦‚`"new": "+"`å’Œ`"initText": "ç‚¹å‡»å·¦ä¾§ç¬”è®°æŸ¥é˜…å†…å®¹ ğŸ¥º"`ã€‚è¿™ç§è®¾è®¡ç®€åŒ–äº†ç¿»è¯‘æŸ¥æ‰¾è¿‡ç¨‹ï¼Œæé«˜äº†æ€§èƒ½ã€‚èµ„æºæ–‡ä»¶é€šè¿‡åŠ¨æ€å¯¼å…¥æœºåˆ¶æŒ‰éœ€åŠ è½½ï¼Œå‡å°‘åˆå§‹åŠ è½½ä½“ç§¯ã€‚

```mermaid
graph TB
Locales[locales/] --> Zh[zh/]
Locales --> En[en/]
Zh --> BasicZh[basic.json]
En --> BasicEn[basic.json]
BasicZh --> |åŒ…å«| TranslationsZh["é”®å€¼å¯¹: \"new\": \"+\"", \"initText\": \"ç‚¹å‡»å·¦ä¾§ç¬”è®°æŸ¥é˜…å†…å®¹ ğŸ¥º\""]
BasicEn --> |åŒ…å«| TranslationsEn["é”®å€¼å¯¹: \"new\": \"new\"", \"initText\": \"Click a note on the left to view something! ğŸ¥º\""]
```

**Diagram sources**
- [app/i18n/locales/zh/basic.json](file://app/i18n/locales/zh/basic.json#L1-L6)
- [app/i18n/locales/en/basic.json](file://app/i18n/locales/en/basic.json#L1-L6)

## æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯i18nåˆå§‹åŒ–

æœåŠ¡ç«¯i18nåˆå§‹åŒ–é€šè¿‡`app/i18n/index.ts`ä¸­çš„`useTranslation`å‡½æ•°å®ç°ã€‚è¯¥å‡½æ•°å¼‚æ­¥åˆ›å»ºi18nextå®ä¾‹ï¼Œé…ç½®æ”¯æŒçš„è¯­è¨€ã€å›é€€è¯­è¨€å’Œå‘½åç©ºé—´ï¼Œå¹¶ä½¿ç”¨`resourcesToBackend`ä»`locales`ç›®å½•åŠ¨æ€åŠ è½½å¯¹åº”è¯­è¨€çš„JSONèµ„æºæ–‡ä»¶ã€‚

å®¢æˆ·ç«¯i18nåˆå§‹åŒ–åœ¨`app/i18n/client.ts`ä¸­å®Œæˆï¼Œä½¿ç”¨`use client`æŒ‡ä»¤æ ‡è¯†ä¸ºå®¢æˆ·ç«¯ç»„ä»¶ã€‚å®ƒåˆå§‹åŒ–i18nextå®ä¾‹å¹¶é›†æˆ`LanguageDetector`æ’ä»¶ï¼ŒæŒ‰ç…§è·¯å¾„ã€HTMLæ ‡ç­¾ã€Cookieå’Œæµè§ˆå™¨è¯­è¨€æ£€æµ‹å™¨çš„é¡ºåºç¡®å®šå½“å‰è¯­è¨€ã€‚å®¢æˆ·ç«¯è¿˜é€šè¿‡Reactçš„`useEffect`é’©å­ç›‘å¬è¯­è¨€å˜åŒ–ï¼Œå¹¶å°†é€‰æ‹©çš„è¯­è¨€å­˜å‚¨åœ¨Cookieä¸­ä»¥ä¿æŒç”¨æˆ·åå¥½ã€‚

```mermaid
sequenceDiagram
participant Server as "æœåŠ¡ç«¯"
participant Client as "å®¢æˆ·ç«¯"
participant Resources as "èµ„æºæ–‡ä»¶"
Server->>Server : è°ƒç”¨useTranslation(lng, ns)
Server->>Server : åˆ›å»ºi18nextå®ä¾‹
Server->>Server : é…ç½®æ”¯æŒè¯­è¨€å’Œå›é€€è¯­è¨€
Server->>Resources : åŠ¨æ€å¯¼å…¥locales/{language}/{namespace}.json
Resources-->>Server : è¿”å›ç¿»è¯‘èµ„æº
Server->>Server : åˆå§‹åŒ–i18nextå®ä¾‹
Server-->>Server : è¿”å›tå‡½æ•°å’Œi18nå®ä¾‹
Client->>Client : ç»„ä»¶æŒ‚è½½
Client->>Client : åˆå§‹åŒ–i18nextå®ä¾‹
Client->>Client : é…ç½®LanguageDetector
Client->>Client : æŒ‰ä¼˜å…ˆçº§æ£€æµ‹è¯­è¨€
Client->>Client : åŠ è½½é¢„å–è¯­è¨€èµ„æº
Client->>Client : ç›‘å¬è¯­è¨€å˜åŒ–
Client->>Client : æ›´æ–°çŠ¶æ€å’ŒCookie
```

**Diagram sources**
- [app/i18n/index.ts](file://app/i18n/index.ts#L1-L54)
- [app/i18n/client.ts](file://app/i18n/client.ts#L1-L75)

## è¯­è¨€åŒ¹é…ä¸è·¯ç”±é‡å®šå‘æœºåˆ¶

`middleware.ts`æ–‡ä»¶å®ç°äº†è¯­è¨€åŒ¹é…ä¸è‡ªåŠ¨è·¯ç”±é‡å®šå‘çš„æ ¸å¿ƒé€»è¾‘ã€‚ä¸­é—´ä»¶é€šè¿‡`@formatjs/intl-localematcher`åº“è§£æè¯·æ±‚å¤´ä¸­çš„`accept-language`å­—æ®µï¼Œä½¿ç”¨`Negotiator`å·¥å…·æå–å®¢æˆ·ç«¯åå¥½è¯­è¨€åˆ—è¡¨ï¼Œå¹¶åœ¨æ”¯æŒçš„è¯­è¨€åˆ—è¡¨ä¸­è¿›è¡Œæœ€ä½³åŒ¹é…ã€‚

å½“è¯·æ±‚è·¯å¾„ä¸åŒ…å«è¯­è¨€å‰ç¼€æ—¶ï¼Œä¸­é—´ä»¶æ ¹æ®åŒ¹é…ç»“æœè‡ªåŠ¨é‡å®šå‘åˆ°å¯¹åº”è¯­è¨€è·¯ç”±ï¼ˆå¦‚`/en`æˆ–`/zh`ï¼‰ã€‚é»˜è®¤è¯­è¨€ï¼ˆ`zh`ï¼‰çš„è¯·æ±‚ä½¿ç”¨`rewrite`è€Œé`redirect`ï¼Œé¿å…URLå˜åŒ–ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚å…¬å…±æ–‡ä»¶ï¼ˆå¦‚é™æ€èµ„æºï¼‰å’ŒAPIè·¯ç”±è¢«æ’é™¤åœ¨é‡å®šå‘é€»è¾‘ä¹‹å¤–ï¼Œç¡®ä¿ç³»ç»Ÿæ€§èƒ½å’ŒåŠŸèƒ½å®Œæ•´æ€§ã€‚

```mermaid
flowchart TD
Start([è¯·æ±‚è¿›å…¥]) --> ExtractPath["æå–è¯·æ±‚è·¯å¾„"]
ExtractPath --> HasLocale{"è·¯å¾„åŒ…å«è¯­è¨€å‰ç¼€?"}
HasLocale --> |æ˜¯| Skip["è·³è¿‡é‡å®šå‘"]
HasLocale --> |å¦| CheckPublic{"æ˜¯å¦ä¸ºå…¬å…±æ–‡ä»¶?"}
CheckPublic --> |æ˜¯| Skip
CheckPublic --> |å¦| ParseHeader["è§£æAccept-Languageå¤´"]
ParseHeader --> MatchLocale["ä½¿ç”¨LocaleMatcheråŒ¹é…æœ€ä½³è¯­è¨€"]
MatchLocale --> GetLocale["è·å–åŒ¹é…çš„locale"]
GetLocale --> IsDefault{"æ˜¯å¦ä¸ºé»˜è®¤è¯­è¨€?"}
IsDefault --> |æ˜¯| Rewrite["é‡å†™è¯·æ±‚è‡³/{locale}{path}"]
IsDefault --> |å¦| Redirect["é‡å®šå‘è‡³/{locale}{path}"]
Rewrite --> End([å¤„ç†è¯·æ±‚])
Redirect --> End
Skip --> End
```

**Diagram sources**
- [middleware.ts](file://middleware.ts#L1-L50)

## è¯­è¨€é…ç½®å‚æ•°

`config.ts`æ–‡ä»¶å®šä¹‰äº†å›½é™…åŒ–ç³»ç»Ÿçš„æ ¸å¿ƒé…ç½®å‚æ•°ï¼š`locales`æ•°ç»„æŒ‡å®šæ”¯æŒçš„è¯­è¨€åˆ—è¡¨ï¼ˆ`["zh", "en"]`ï¼‰ï¼Œ`defaultLocale`å¸¸é‡è®¾ç½®é»˜è®¤è¯­è¨€ä¸ºä¸­æ–‡ï¼ˆ`"zh"`ï¼‰ã€‚è¿™äº›é…ç½®è¢«i18næ¨¡å—ã€ä¸­é—´ä»¶å’Œå¸ƒå±€ç»„ä»¶å¹¿æ³›å¼•ç”¨ï¼Œç¡®ä¿ç³»ç»Ÿå„éƒ¨åˆ†è¯­è¨€è®¾ç½®çš„ä¸€è‡´æ€§ã€‚

`locales`é…ç½®ä¸ä»…é™åˆ¶äº†å¯ç”¨è¯­è¨€é€‰é¡¹ï¼Œè¿˜ç”¨äºé™æ€è·¯å¾„ç”Ÿæˆå’Œè¯­è¨€åŒ¹é…è¿‡ç¨‹ã€‚`defaultLocale`é…ç½®å†³å®šäº†å½“æ— æ³•åŒ¹é…ç”¨æˆ·åå¥½æ—¶çš„å›é€€è¯­è¨€ï¼Œä»¥åŠé»˜è®¤è·¯ç”±çš„é‡å†™è¡Œä¸ºã€‚è¿™ç§é›†ä¸­å¼é…ç½®æ–¹å¼ä¾¿äºç»´æŠ¤å’Œæ‰©å±•ï¼Œæ–°å¢è¯­è¨€æ—¶åªéœ€ä¿®æ”¹è¿™ä¸¤ä¸ªå‚æ•°å³å¯ã€‚

**Section sources**
- [config.ts](file://config.ts#L1-L3)

## è¯­è¨€åˆ‡æ¢æµç¨‹

è¯­è¨€åˆ‡æ¢æµç¨‹æ¶‰åŠå¤šä¸ªç»„ä»¶çš„ååŒå·¥ä½œã€‚å½“ç”¨æˆ·è®¿é—®æ— è¯­è¨€å‰ç¼€çš„è·¯å¾„æ—¶ï¼Œä¸­é—´ä»¶è§£æ`accept-language`å¤´ï¼ŒåŒ¹é…æœ€ä½³è¯­è¨€ï¼Œå¹¶é‡å®šå‘åˆ°å¯¹åº”è¯­è¨€è·¯ç”±ã€‚æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼Œ`useTranslation`å‡½æ•°æ ¹æ®è·¯å¾„ä¸­çš„è¯­è¨€å‚æ•°åŠ è½½ç›¸åº”èµ„æºæ–‡ä»¶ï¼Œæä¾›ç¿»è¯‘å‡½æ•°`t`ã€‚

å®¢æˆ·ç«¯é€šè¿‡`useTranslation` hookè·å–`t`å‡½æ•°ï¼Œå¹¶ä½¿ç”¨`useEffect`ç›‘å¬è¯­è¨€å˜åŒ–ã€‚å½“è¯­è¨€åˆ‡æ¢å‘ç”Ÿæ—¶ï¼Œå®¢æˆ·ç«¯æ›´æ–°i18nextå®ä¾‹çš„å½“å‰è¯­è¨€ï¼Œå¹¶å°†é€‰æ‹©å­˜å‚¨åœ¨åä¸º`i18next`çš„Cookieä¸­ã€‚åç»­è¯·æ±‚æºå¸¦æ­¤Cookieï¼Œç¡®ä¿ç”¨æˆ·åå¥½è¢«è®°ä½ã€‚

```mermaid
sequenceDiagram
participant User as "ç”¨æˆ·"
participant Browser as "æµè§ˆå™¨"
participant Middleware as "ä¸­é—´ä»¶"
participant Server as "æœåŠ¡ç«¯"
participant Client as "å®¢æˆ·ç«¯"
User->>Browser : è®¿é—® /
Browser->>Middleware : è¯·æ±‚ /
Middleware->>Middleware : è§£æAccept-Language
Middleware->>Middleware : åŒ¹é…æœ€ä½³è¯­è¨€(zh)
Middleware->>Browser : é‡å®šå‘åˆ° /zh
Browser->>Server : è¯·æ±‚ /zh
Server->>Server : è°ƒç”¨useTranslation("zh")
Server->>Server : åŠ è½½zh/basic.json
Server->>Browser : è¿”å›æ¸²æŸ“çš„HTML
Browser->>Client : æ‰§è¡Œå®¢æˆ·ç«¯ä»£ç 
Client->>Client : åˆå§‹åŒ–i18next
Client->>Client : æ£€æµ‹Cookieä¸­çš„è¯­è¨€
Client->>Client : è®¾ç½®å½“å‰è¯­è¨€
Client->>Client : ç›‘å¬è¯­è¨€å˜åŒ–
```

**Diagram sources**
- [middleware.ts](file://middleware.ts#L1-L50)
- [app/i18n/index.ts](file://app/i18n/index.ts#L1-L54)
- [app/i18n/client.ts](file://app/i18n/client.ts#L1-L75)

## ç»„ä»¶ä¸­çš„æ–‡æœ¬ç¿»è¯‘ä½¿ç”¨

åœ¨Reactç»„ä»¶ä¸­ï¼Œé€šè¿‡å¯¼å…¥å¹¶è°ƒç”¨`useTranslation` hookè·å–`t`å‡½æ•°è¿›è¡Œæ–‡æœ¬ç¿»è¯‘ã€‚`t`å‡½æ•°æ¥æ”¶ç¿»è¯‘é”®ä½œä¸ºå‚æ•°ï¼Œè¿”å›å¯¹åº”è¯­è¨€çš„ç¿»è¯‘æ–‡æœ¬ã€‚ä¾‹å¦‚ï¼Œåœ¨ç»„ä»¶ä¸­è°ƒç”¨`t('new')`å°†æ ¹æ®å½“å‰è¯­è¨€è¿”å›`"+"`ï¼ˆä¸­æ–‡ï¼‰æˆ–`"new"`ï¼ˆè‹±æ–‡ï¼‰ã€‚

`useTranslation`éœ€è¦ä¼ å…¥å½“å‰è¯­è¨€å‚æ•°ï¼ˆ`lng`ï¼‰ï¼Œé€šå¸¸ä»è·¯ç”±å‚æ•°è·å–ã€‚è¯¥hookè¿”å›`t`å‡½æ•°å’Œ`i18n`å®ä¾‹ï¼Œå…è®¸ç»„ä»¶è®¿é—®ç¿»è¯‘åŠŸèƒ½å’Œè¯­è¨€çŠ¶æ€ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‰€æœ‰ç”¨æˆ·ç•Œé¢æ–‡æœ¬éƒ½å¯å®ç°å¤šè¯­è¨€æ”¯æŒï¼Œç¡®ä¿åº”ç”¨çš„å›½é™…åŒ–èƒ½åŠ›ã€‚

**Section sources**
- [app/i18n/client.ts](file://app/i18n/client.ts#L46-L73)

## é™æ€è·¯å¾„é¢„ç”Ÿæˆ

`app/[lng]/layout.tsx`æ–‡ä»¶ä¸­çš„`generateStaticParams`å‡½æ•°è´Ÿè´£é¢„ç”Ÿæˆå¤šè¯­è¨€é™æ€è·¯å¾„ã€‚è¯¥å‡½æ•°åˆ©ç”¨`config.ts`ä¸­çš„`locales`é…ç½®ï¼Œä¸ºæ¯ä¸ªæ”¯æŒçš„è¯­è¨€ç”Ÿæˆå¯¹åº”çš„é™æ€å‚æ•°å¯¹è±¡ã€‚Next.jsåœ¨æ„å»ºæ—¶è°ƒç”¨æ­¤å‡½æ•°ï¼Œä¸º`/zh`å’Œ`/en`ç­‰è¯­è¨€è·¯å¾„ç”Ÿæˆé™æ€é¡µé¢ã€‚

è¿™ç§é¢„ç”Ÿæˆç­–ç•¥é¿å…äº†è¿è¡Œæ—¶åŠ¨æ€æ¸²æŸ“çš„æ€§èƒ½å¼€é”€ï¼Œæå‡äº†é¡µé¢åŠ è½½é€Ÿåº¦å’ŒSEOæ•ˆæœã€‚æ¯ä¸ªè¯­è¨€ç‰ˆæœ¬çš„é¡µé¢åœ¨æ„å»ºæ—¶ç‹¬ç«‹ç”Ÿæˆï¼Œç¡®ä¿æœåŠ¡ç«¯æ¸²æŸ“çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚å½“æ–°å¢è¯­è¨€æ—¶ï¼Œåªéœ€åœ¨`locales`é…ç½®ä¸­æ·»åŠ è¯­è¨€ä»£ç ï¼Œ`generateStaticParams`å°†è‡ªåŠ¨åŒ…å«æ–°è¯­è¨€çš„é™æ€è·¯å¾„ã€‚

**Section sources**
- [app/[lng]/layout.tsx](file://app/[lng]/layout.tsx#L15-L17)
- [config.ts](file://config.ts#L1-L3)