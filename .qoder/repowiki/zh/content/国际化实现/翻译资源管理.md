# 翻译资源管理

<cite>
**Referenced Files in This Document**  
- [index.ts](file://app/i18n/index.ts)
- [client.ts](file://app/i18n/client.ts)
- [config.ts](file://config.ts)
- [middleware.ts](file://middleware.ts)
- [basic.json](file://app/i18n/locales/zh/basic.json)
- [basic.json](file://app/i18n/locales/en/basic.json)
- [layout.tsx](file://app/[lng]/layout.tsx)
</cite>

## 目录
1. [翻译资源组织结构](#翻译资源组织结构)
2. [JSON键值对设计规范](#json键值对设计规范)
3. [动态加载机制](#动态加载机制)
4. [默认命名空间的使用](#默认命名空间的使用)
5. [静态路径预生成](#静态路径预生成)
6. [新增语言流程](#新增语言流程)

## 翻译资源组织结构

翻译资源按照语言维度进行组织，所有语言资源集中存放在`app/i18n/locales/`目录下。每个支持的语言都有独立的子目录（如`zh/`、`en/`），在每个语言目录中存放对应命名空间的JSON文件。当前系统采用`basic`作为默认命名空间，所有语言均提供`basic.json`文件以确保基础翻译内容的完整性。

**Section sources**
- [index.ts](file://app/i18n/index.ts#L1-L54)
- [client.ts](file://app/i18n/client.ts#L1-L75)

## JSON键值对设计规范

系统采用语义化键名而非原始文本作为JSON键值对的设计原则。这种设计方式具有以下优势：

- **可维护性**：通过语义化键名（如`note.new`、`button.save`）可以清晰表达文本用途，便于团队协作和后期维护
- **灵活性**：当需要调整界面文本时，只需修改对应语言的JSON文件，无需改动代码逻辑
- **一致性**：避免在代码中散落大量字符串字面量，统一管理所有用户界面文本

当前`basic.json`文件中定义了基础的语义化键名，如`new`、`initText`、`search`等，这些键名在不同语言版本中保持一致，仅对应值随语言变化。

**Section sources**
- [basic.json](file://app/i18n/locales/zh/basic.json#L1-L6)
- [basic.json](file://app/i18n/locales/en/basic.json#L1-L6)

## 动态加载机制

系统通过`i18next-resources-to-backend`库实现翻译资源的按需动态加载。`resourcesToBackend`函数配置了资源加载器，使用动态`import()`语法按需导入特定语言和命名空间的JSON文件：

```typescript
resourcesToBackend((language: string, namespace: string) =>
  import(`./locales/${language}/${namespace}.json`)
)
```

该机制的核心优势在于：
- **减少初始加载体积**：仅在需要时加载对应语言资源，避免一次性加载所有翻译文件
- **支持代码分割**：每个语言资源文件被构建为独立的chunk，实现真正的按需加载
- **提升性能**：用户访问时只下载当前语言所需资源，降低带宽消耗和内存占用

此机制在服务端和客户端初始化时均被配置使用，确保一致的行为表现。

**Section sources**
- [index.ts](file://app/i18n/index.ts#L15-L35)
- [client.ts](file://app/i18n/client.ts#L28-L38)

## 默认命名空间的使用

`basic`命名空间作为系统的默认命名空间（defaultNS），在服务端和客户端均保持一致性使用。系统配置中明确指定了`defaultNS: "basic"`和`fallbackNS: "basic"`，确保：

- 当未指定命名空间时，默认使用`basic`命名空间
- 当请求的命名空间不存在时，回退到`basic`命名空间
- 所有页面和组件在调用`useTranslation`时，若未指定命名空间，则自动使用`basic`

这种一致性设计简化了开发体验，开发者无需在每个使用翻译的地方显式指定命名空间，同时保证了系统稳定性和可预测性。

**Section sources**
- [index.ts](file://app/i18n/index.ts#L29-L35)
- [client.ts](file://app/i18n/client.ts#L33-L38)

## 静态路径预生成

系统通过`generateStaticParams`函数在构建时预生成所有支持语言的静态路径。该函数位于`app/[lng]/layout.tsx`文件中：

```typescript
export async function generateStaticParams() {
  return locales.map((lng: string) => ({ lng }));
}
```

此实践的关键作用包括：
- **构建时确定性**：在构建阶段生成`/en`和`/zh`等静态路径，而非运行时动态渲染
- **性能优化**：生成的页面可被CDN缓存，显著提升访问速度
- **SEO友好**：搜索引擎可直接抓取不同语言版本的页面内容
- **资源完整性**：确保所有翻译资源在构建时被正确引用和打包，避免运行时缺失

通过与`locales`配置数组的集成，系统自动为每个支持的语言生成对应的静态路由。

**Section sources**
- [layout.tsx](file://app/[lng]/layout.tsx#L10-L12)
- [config.ts](file://config.ts#L1-L3)

## 新增语言流程

新增语言（如添加法语`fr`）需要完成以下完整操作步骤：

### 1. 扩展配置文件
修改`config.ts`文件，将新语言添加到`locales`数组中，并可选择性设置为默认语言：

```typescript
export const locales = ["zh", "en", "fr"];
export const defaultLocale = "zh";
```

### 2. 创建语言资源文件夹
在`app/i18n/locales/`目录下创建对应的语言文件夹，并复制`basic.json`模板：

```
app/i18n/locales/fr/basic.json
```

### 3. 翻译JSON内容
根据目标语言翻译`basic.json`文件中的所有键值对，保持键名不变：

```json
{
  "new": "nouveau",
  "initText": "Cliquez sur une note à gauche pour voir quelque chose ! 🥺",
  "search": "rechercher"
}
```

### 4. 更新中间件匹配逻辑
检查`middleware.ts`中的语言匹配逻辑，确保新语言被正确识别和处理。当前实现已基于`locales`数组动态匹配，通常无需额外修改。

### 5. 验证静态生成
确认`generateStaticParams`函数会自动为新语言生成静态路径，构建过程包含新语言的所有资源。

通过以上步骤，系统即可完整支持新语言，且所有机制（动态加载、静态生成、回退策略等）均自动适配新语言。

**Section sources**
- [config.ts](file://config.ts#L1-L3)
- [middleware.ts](file://middleware.ts#L1-L50)
- [layout.tsx](file://app/[lng]/layout.tsx#L10-L12)
- [basic.json](file://app/i18n/locales/fr/basic.json)